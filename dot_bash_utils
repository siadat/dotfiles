# Bash utils by Sina
# Source this in your ~/.bash_profile
# vim: ft=bash
export HISTFILESIZE=1000000
export HISTSIZE=1000000
export EDITOR=nvim
alias v="${EDITOR} -O"
alias view="${EDITOR} -R -O"
alias date-slug='date +%F-%T'
alias grep='grep --color'
alias abspath='readlink -f'

alias p='git pull origin HEAD'
alias push='git push origin HEAD'
alias gd='git diff --stat -p -w' # -U0
alias gdc='git diff --stat -p -w --cached' # -U0
alias gsh='git show --stat -p -w' #  -U0
alias gs='git status'
alias zig='LD_LIBRARY_PATH=$(brew --prefix)/lib ~/src/zig/build/stage3/bin/zig'

# open results of rg in EDITOR
function vrg() {
  $EDITOR -O $(rg -l "$@")
}

function capture () {
    local out;
    out="$(mktemp --tmpdir=. --suffix=.txt)";
    tmux capture-pane -J -S- -b mybuf;
    tmux save-buffer -b mybuf "${out}";
    echo "${out}";
    nvim "${out}"
}

function dotfiles {
	(
		echo "chezmoi update" && chezmoi update
		echo "chezmoi apply" && chezmoi apply
		cd ~/.local/share/chezmoi/
		git add -u
		git --no-pager diff -w --exit-code --stat -p origin/main && return
		git status
		read -r -p "Commit and push? [y/N] " response
		case "$response" in
			y)
				git commit -m "chezmoi: update"
				git push
				;;
			*)
				echo "Aborted"
				;;
		esac
	)
}
